#!/usr/bin/env zsh
# z4m-preview-b64 - Decode base64 key then delegate to z4m-preview.
# Usage: z4m-preview-b64 <context> <word_b64> [path_prefix]

emulate -L zsh -o typeset_silent -o pipe_fail

local ctx=$1 b64=$2 path_prefix=$3

[[ -n $b64 ]] || exit 0

# Validate as data-only payload (consistent with -z4m-b64dec-fast)
[[ $b64 =~ '^[A-Za-z0-9+/=]+$' ]] || exit 0

local word
word=$(print -r -- "$b64" | command base64 -d 2>/dev/null) ||
	word=$(print -r -- "$b64" | command base64 -D 2>/dev/null) || exit 0

# Delegate to the existing preview dispatcher.
"${0:A:h}/z4m-preview" "$ctx" "$word" "$path_prefix"
